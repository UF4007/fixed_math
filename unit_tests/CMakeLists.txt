include( CheckCXXSourceCompiles )

set( TEST_DEFINITIONS -DFIXEDMATH_ENABLE_SQRT_ABACUS_ALGO )
function(add_compile_test HEADER_FILE_NAME )
  get_filename_component(TEST_NAME ${HEADER_FILE_NAME} NAME_WE)
  set( SOURCE_FILE_NAME test_${TEST_NAME}.cc )
  get_target_property( FIXED_MATH_INCLUDES fixed_math INCLUDE_DIRECTORIES)
  file(WRITE ${CMAKE_CURRENT_BINARY_DIR}/${SOURCE_FILE_NAME} "#include <fixedmath/unittests/${HEADER_FILE_NAME}.h>\nint main( int argc, char ** argv ) {return EXIT_SUCCESS; }\n" )
  add_test(NAME ${TEST_NAME} 
    COMMAND ${CMAKE_CXX_COMPILER} -std=c++17 ${TEST_DEFINITIONS} -I${FIXED_MATH_INCLUDES} ${CMAKE_CURRENT_BINARY_DIR}/${SOURCE_FILE_NAME} -o ${CMAKE_CURRENT_BINARY_DIR}/test_${TEST_NAME}.o )
endfunction()

add_compile_test( type_traits )
add_compile_test( integral_type_convertions )
add_compile_test( floating_point_type_convertions )
add_compile_test( fixed_construction )
add_compile_test( addition )
add_compile_test( substraction )
add_compile_test( multiplication )
add_compile_test( division )
add_compile_test( sqrt )
add_compile_test( misc_functions )
add_compile_test( sin )
add_compile_test( tan )
add_compile_test( atan )
